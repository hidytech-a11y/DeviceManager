@model DeviceManager.Models.DeviceListViewModel

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Devices</h2>

        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Create" class="btn btn-primary btn-sm">
                Add Device
            </a>
        }
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body p-3">

            <form method="get" class="row g-2 align-items-end">

                <div class="col-md-3">
                    <label class="form-label">Search</label>
                    <input name="search"
                           value="@Model.Search"
                           class="form-control form-control-sm"
                           placeholder="Name or Serial" />
                </div>

                <div class="col-md-3">
                    <label class="form-label">Type</label>
                    <select name="typeFilter" class="form-select form-select-sm">
                        <option value="">All</option>
                        @foreach (var t in (IEnumerable<DeviceType>)ViewBag.AvailableTypes)
                        {
                            <option value="@t.Name" selected="@(Model.TypeFilter == t.Name)">
                                @t.Name
                            </option>
                        }
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Status</label>
                    <select name="statusFilter" class="form-select form-select-sm">
                        <option value="">All</option>
                        <option value="Active" selected="@(Model.StatusFilter == "Active")">Active</option>
                        <option value="Inactive" selected="@(Model.StatusFilter == "Inactive")">Inactive</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Sort</label>
                    <select name="sortOrder" class="form-select form-select-sm">
                        <option value="">Name</option>
                        <option value="name_desc" selected="@(Model.SortOrder == "name_desc")">Name Desc</option>
                        <option value="type" selected="@(Model.SortOrder == "type")">Type</option>
                        <option value="type_desc" selected="@(Model.SortOrder == "type_desc")">Type Desc</option>
                    </select>
                </div>

                <div class="col-md-2 d-flex gap-2">
                    <button class="btn btn-primary btn-sm w-100">
                        Apply
                    </button>

                    <a asp-action="Index"
                       class="btn btn-outline-secondary btn-sm w-100">
                        Reset
                    </a>
                </div>

            </form>

        </div>
    </div>

    <!-- Table -->
    <div class="card">
        <div class="table-responsive">
            <table class="table table-hover mb-0">

                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Serial</th>
                        <th>Status</th>
                        <th>Technician</th>
                        <th>Work Status</th>
                        <th class="text-end">Action</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var d in Model.Devices)
                    {
                        <tr>
                            <td>@d.Name</td>
                            <td>@d.DeviceType?.Name</td>
                            <td>@d.SerialNumber</td>

                            <td>
                                @if (d.Status == "Active")
                                {
                                    <span class="badge bg-success">Active</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary">Inactive</span>
                                }
                            </td>

                            <td>@(d.Technician?.FullName ?? "Unassigned")</td>

                            <td>
                                @if (d.WorkStatus == "Assigned")
                                {
                                    <span class="badge bg-secondary">Assigned</span>
                                }
                                else if (d.WorkStatus == "InProgress")
                                {
                                    <span class="badge bg-warning text-dark">In Progress</span>
                                }
                                else if (d.WorkStatus == "Done" && d.IsApprovedByManager)
                                {
                                    <span class="badge bg-success">Approved</span>
                                }
                                else if (d.WorkStatus == "Done")
                                {
                                    <span class="badge bg-info text-dark">Done</span>
                                }
                            </td>

                            <td class="text-end">
                                <a asp-action="Details"
                                   asp-route-id="@d.Id"
                                   class="btn btn-outline-secondary btn-sm">
                                    View
                                </a>

                                @if (User.IsInRole("Admin"))
                                {
                                    <a asp-action="Edit"
                                       asp-route-id="@d.Id"
                                       class="btn btn-outline-primary btn-sm">
                                        Edit
                                    </a>

                                    <a asp-action="Delete"
                                       asp-route-id="@d.Id"
                                       class="btn btn-outline-danger btn-sm">
                                        Delete
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>

    <!-- Pagination -->
    <nav class="mt-3">
        <ul class="pagination pagination-sm">

            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                    <a class="page-link"
                       href="?pageNumber=@i&search=@Model.Search&sortOrder=@Model.SortOrder&typeFilter=@Model.TypeFilter&statusFilter=@Model.StatusFilter">
                        @i
                    </a>
                </li>
            }

        </ul>
    </nav>


</div>
